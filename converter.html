<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s9 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s10 {font-kerning: none}
    span.s11 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s12 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s13 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s14 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s15 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">CSV to QDC Codebook Converter</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"preconnect"</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"preconnect"</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.gstatic.com"</span><span class="s4"> </span><span class="s2">crossorigin</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Inter'</span><span class="s7">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.file-drop-area</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s7">,</span><span class="s4"> </span><span class="s1">border-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.file-drop-area.dragover</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #e0f2fe</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> #0284c7</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen p-4"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full max-w-2xl bg-white rounded-xl shadow-lg p-8 md:p-12"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl md:text-4xl font-bold text-slate-900"</span><span class="s3">&gt;</span><span class="s4">CSV to QDC Converter</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mt-2 text-slate-600"</span><span class="s3">&gt;</span><span class="s1">A simple tool to convert your codebook from a CSV file to an NVivo-compatible .qdc file.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"file-drop-area"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-8 border-2 border-dashed border-slate-300 rounded-lg p-8 text-center cursor-pointer"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"file-input"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">".csv"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"upload-prompt"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mx-auto h-12 w-12 text-slate-400"</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 48 48"</span><span class="s4"> </span><span class="s2">aria-hidden</span><span class="s3">=</span><span class="s1">"true"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s2">d</span><span class="s3">=</span><span class="s1">"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28"</span><span class="s4"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s3">&gt;&lt;/</span><span class="s6">path</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 text-lg text-slate-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"font-semibold text-sky-600"</span><span class="s3">&gt;</span><span class="s1">Click to upload</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> or drag and drop</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-slate-500"</span><span class="s3">&gt;</span><span class="s1">CSV files only</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"file-info"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden text-left"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"font-semibold text-slate-700"</span><span class="s3">&gt;</span><span class="s1">Selected File:</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"file-name"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sky-700 truncate"</span><span class="s3">&gt;&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-6 text-center"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"convert-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full bg-sky-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-all duration-200 disabled:bg-slate-300 disabled:cursor-not-allowed"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>Convert and Download</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"message-box"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-6 p-4 rounded-md text-center hidden"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-8 pt-6 border-t border-slate-200"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold text-slate-800"</span><span class="s3">&gt;</span><span class="s4">Instructions</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">ul</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-2 list-disc list-inside text-slate-600 space-y-1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;</span><span class="s1">Your CSV file's first row should be a header (e.g., "Code Name", "Description"). It will be skipped.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;</span><span class="s1">**Column 1:** The name of the code (e.g., "1.1 External Pressure").</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;</span><span class="s1">**Column 2:** A description for the code.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;</span><span class="s1">The script creates a flat list of codes, perfect for manual organization in NVivo.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">li</span><span class="s3">&gt;</span><span class="s1">🔒 </span><span class="s3">&lt;</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1">Reminder:</span><span class="s3">&lt;/</span><span class="s6">strong</span><span class="s3">&gt;</span><span class="s1"> Like any online platform, this converter may not be suitable for sensitive or confidential files. Please avoid uploading such documents.</span><span class="s3">&lt;/</span><span class="s6">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">ul</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- DOM Element References ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileDropArea </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'file-drop-area'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'file-input'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> convertBtn </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'convert-btn'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> uploadPrompt </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'upload-prompt'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileInfo </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'file-info'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileNameEl </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'file-name'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> messageBox </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'message-box'</span><span class="s7">);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">let</span><span class="s1"> csvContent </span><span class="s7">=</span><span class="s1"> </span><span class="s11">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>convertBtn</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s11">true</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Event Listeners ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileDropArea</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> fileInput</span><span class="s7">.</span><span class="s1">click</span><span class="s7">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInput</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'change'</span><span class="s7">,</span><span class="s1"> handleFileSelect</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>convertBtn</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> processConversion</span><span class="s7">);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Drag and Drop functionality</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">[</span><span class="s1">'dragenter'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'dragover'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'dragleave'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'drop'</span><span class="s7">].</span><span class="s4">forEach</span><span class="s7">(</span><span class="s4">eventName </span><span class="s7">=&gt;</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileDropArea</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s1">eventName</span><span class="s7">,</span><span class="s1"> preventDefaults</span><span class="s7">,</span><span class="s1"> </span><span class="s11">false</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">[</span><span class="s8">'dragenter'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'dragover'</span><span class="s7">].</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">eventName </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileDropArea</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s1">eventName</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> fileDropArea</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'dragover'</span><span class="s7">),</span><span class="s1"> </span><span class="s11">false</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">[</span><span class="s8">'dragleave'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'drop'</span><span class="s7">].</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">eventName </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileDropArea</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s1">eventName</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> fileDropArea</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'dragover'</span><span class="s7">),</span><span class="s1"> </span><span class="s11">false</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileDropArea</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'drop'</span><span class="s7">,</span><span class="s1"> handleDrop</span><span class="s7">,</span><span class="s1"> </span><span class="s11">false</span><span class="s7">);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> preventDefaults</span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>e</span><span class="s7">.</span><span class="s1">preventDefault</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>e</span><span class="s7">.</span><span class="s1">stopPropagation</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> handleDrop</span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> dt </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">dataTransfer</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> files </span><span class="s7">=</span><span class="s1"> dt</span><span class="s7">.</span><span class="s1">files</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">files</span><span class="s7">.</span><span class="s1">length </span><span class="s7">&gt;</span><span class="s1"> </span><span class="s12">0</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileInput</span><span class="s7">.</span><span class="s1">files </span><span class="s7">=</span><span class="s1"> files</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>handleFileSelect</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> handleFileSelect</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> fileInput</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s12">0</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>resetUI</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">.</span><span class="s1">toLowerCase</span><span class="s7">().</span><span class="s1">endsWith</span><span class="s7">(</span><span class="s8">'.csv'</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showMessage</span><span class="s7">(</span><span class="s1">'error'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'Invalid file type. Please upload a .csv file.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>resetUI</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> reader </span><span class="s7">=</span><span class="s1"> </span><span class="s11">new</span><span class="s1"> </span><span class="s13">FileReader</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">onload </span><span class="s7">=</span><span class="s1"> </span><span class="s11">function</span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>csvContent </span><span class="s7">=</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">result</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileNameEl</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>uploadPrompt</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileInfo</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>convertBtn</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s11">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageBox</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">onerror </span><span class="s7">=</span><span class="s1"> </span><span class="s11">function</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>showMessage</span><span class="s7">(</span><span class="s8">'error'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'Error reading file.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>resetUI</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">readAsText</span><span class="s7">(</span><span class="s1">file</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'UTF-8'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> resetUI</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>csvContent </span><span class="s7">=</span><span class="s1"> </span><span class="s11">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>uploadPrompt</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileInfo</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>convertBtn</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s11">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> showMessage</span><span class="s7">(</span><span class="s1">type</span><span class="s7">,</span><span class="s1"> text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageBox</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageBox</span><span class="s7">.</span><span class="s1">className </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'mt-6 p-4 rounded-md text-center'</span><span class="s7">;</span><span class="s1"> </span><span class="s14">// Reset classes</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">type </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'error'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageBox</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'bg-red-100'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'text-red-700'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageBox</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'bg-green-100'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'text-green-700'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageBox</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'hidden'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> processConversion</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">csvContent</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showMessage</span><span class="s7">(</span><span class="s1">'error'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'No file content to process. Please select a file first.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> qdcXml </span><span class="s7">=</span><span class="s1"> createQdcContent</span><span class="s7">(</span><span class="s1">csvContent</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">qdcXml</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>downloadFile</span><span class="s7">(</span><span class="s1">qdcXml</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'codebook.qdc'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage</span><span class="s7">(</span><span class="s1">'error'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'Could not generate QDC file. The CSV might be empty or formatted incorrectly.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showMessage</span><span class="s7">(</span><span class="s1">'error'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">`An unexpected error occurred: </span><span class="s7">${</span><span class="s4">e</span><span class="s7">.</span><span class="s4">message</span><span class="s7">}</span><span class="s1">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s1">e</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Core Conversion Logic (Translated from Python) ---</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s14">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* Generates a UUID.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* @returns {string} A version 4 UUID.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> generateUuid</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">return</span><span class="s1"> crypto</span><span class="s7">.</span><span class="s1">randomUUID</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s14">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* Creates the QDC XML string from the raw text content of a CSV file.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} csvFileContent - The full text of the uploaded CSV.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* @returns {string|null} The QDC XML string or null if an error occurs.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> createQdcContent</span><span class="s7">(</span><span class="s1">csvFileContent</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s4"> </span><span class="s13">HEADER</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></p>
<p class="p7"><span class="s1">&lt;CodeBook xmlns="urn:QDA-XML:codebook:1:0"&gt;</span></p>
<p class="p7"><span class="s1">&lt;Codes&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> </span><span class="s13">FOOTER</span><span class="s1"> </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`&lt;/Codes&gt;</span></p>
<p class="p7"><span class="s1">&lt;/CodeBook&gt;`</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s4"> </span><span class="s13">COLOURS</span><span class="s4"> </span><span class="s7">=</span><span class="s4"> </span><span class="s7">[</span><span class="s1">'#00FF00'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#FF0000'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#FFFF00'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#0000FF'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#008080'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#00FFFF'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#FF00FF'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'#008000'</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">let</span><span class="s1"> colourIndex </span><span class="s7">=</span><span class="s1"> </span><span class="s12">0</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">let</span><span class="s1"> xmlParts </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> rows </span><span class="s7">=</span><span class="s1"> csvFileContent</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">().</span><span class="s1">split</span><span class="s7">(</span><span class="s8">'\n'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>rows</span><span class="s7">.</span><span class="s1">shift</span><span class="s7">();</span><span class="s1"> </span><span class="s14">// Skip header</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">rows</span><span class="s7">.</span><span class="s1">length </span><span class="s7">===</span><span class="s1"> </span><span class="s12">0</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s1"> </span><span class="s11">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>rows</span><span class="s7">.</span><span class="s1">forEach</span><span class="s7">(</span><span class="s1">rowStr </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">rowStr</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">())</span><span class="s1"> </span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// New logic to handle commas inside the description field.</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">let</span><span class="s1"> label </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">let</span><span class="s1"> description </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> firstCommaIndex </span><span class="s7">=</span><span class="s1"> rowStr</span><span class="s7">.</span><span class="s1">indexOf</span><span class="s7">(</span><span class="s8">','</span><span class="s7">);</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">firstCommaIndex </span><span class="s7">===</span><span class="s1"> </span><span class="s7">-</span><span class="s12">1</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// No comma, entire line is the label</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>label </span><span class="s7">=</span><span class="s1"> rowStr</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Comma found, split into label and description</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>label </span><span class="s7">=</span><span class="s1"> rowStr</span><span class="s7">.</span><span class="s1">substring</span><span class="s7">(</span><span class="s12">0</span><span class="s7">,</span><span class="s1"> firstCommaIndex</span><span class="s7">).</span><span class="s1">trim</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>description </span><span class="s7">=</span><span class="s1"> rowStr</span><span class="s7">.</span><span class="s1">substring</span><span class="s7">(</span><span class="s1">firstCommaIndex </span><span class="s7">+</span><span class="s1"> </span><span class="s12">1</span><span class="s7">).</span><span class="s1">trim</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Clean up any surrounding quotes</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>label </span><span class="s7">=</span><span class="s1"> label</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/^"|"$/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">''</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>description </span><span class="s7">=</span><span class="s1"> description</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/^"|"$/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">''</span><span class="s7">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">label</span><span class="s7">)</span><span class="s1"> </span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> guid </span><span class="s7">=</span><span class="s1"> generateUuid</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> colour </span><span class="s7">=</span><span class="s1"> </span><span class="s13">COLOURS</span><span class="s7">[</span><span class="s1">colourIndex </span><span class="s7">%</span><span class="s1"> </span><span class="s13">COLOURS</span><span class="s7">.</span><span class="s1">length</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>colourIndex</span><span class="s7">++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> colourAttr </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`color="</span><span class="s7">${</span><span class="s1">colour</span><span class="s7">}</span><span class="s8">"`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> isCodable </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'true'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> name </span><span class="s7">=</span><span class="s1"> label</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">let</span><span class="s1"> openingTag </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`&lt;Code </span><span class="s7">${</span><span class="s1">colourAttr</span><span class="s7">}</span><span class="s8"> guid="</span><span class="s7">${</span><span class="s1">guid</span><span class="s7">}</span><span class="s8">" isCodable="</span><span class="s7">${</span><span class="s1">isCodable</span><span class="s7">}</span><span class="s8">" name="</span><span class="s7">${</span><span class="s1">name</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&amp;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;amp;'</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&lt;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;lt;'</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&gt;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;gt;'</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/"/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;quot;'</span><span class="s7">)}</span><span class="s8">"`</span><span class="s7">;</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">description</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>xmlParts</span><span class="s7">.</span><span class="s1">push</span><span class="s7">(</span><span class="s1">openingTag </span><span class="s7">+</span><span class="s1"> </span><span class="s8">' /&gt;'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">let</span><span class="s1"> descXml </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`&lt;Description&gt;</span><span class="s7">${</span><span class="s1">description</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&amp;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;amp;'</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&lt;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;lt;'</span><span class="s7">).</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/&gt;/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'&amp;gt;'</span><span class="s7">)}</span><span class="s8">&lt;/Description&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>xmlParts</span><span class="s7">.</span><span class="s1">push</span><span class="s7">(</span><span class="s1">openingTag </span><span class="s7">+</span><span class="s1"> </span><span class="s8">'&gt;'</span><span class="s1"> </span><span class="s7">+</span><span class="s1"> descXml </span><span class="s7">+</span><span class="s1"> </span><span class="s8">'&lt;/Code&gt;'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">return</span><span class="s1"> </span><span class="s7">[</span><span class="s13">HEADER</span><span class="s7">,</span><span class="s1"> </span><span class="s7">...</span><span class="s1">xmlParts</span><span class="s7">,</span><span class="s1"> </span><span class="s13">FOOTER</span><span class="s7">].</span><span class="s1">join</span><span class="s7">(</span><span class="s8">'\n'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s14">/**</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* Triggers a browser download for the generated file content.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} content - The text content of the file to download.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>*- @param {string} filename - The desired name of the downloaded file.</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> downloadFile</span><span class="s7">(</span><span class="s1">content</span><span class="s7">,</span><span class="s1"> filename</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> blob </span><span class="s7">=</span><span class="s1"> </span><span class="s11">new</span><span class="s1"> </span><span class="s13">Blob</span><span class="s7">([</span><span class="s1">content</span><span class="s7">],</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> type</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'application/xml;charset=utf-8;'</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> link </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">"a"</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">link</span><span class="s7">.</span><span class="s1">download </span><span class="s7">!==</span><span class="s1"> </span><span class="s11">undefined</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> url </span><span class="s7">=</span><span class="s1"> </span><span class="s13">URL</span><span class="s7">.</span><span class="s1">createObjectURL</span><span class="s7">(</span><span class="s1">blob</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">setAttribute</span><span class="s7">(</span><span class="s8">"href"</span><span class="s7">,</span><span class="s1"> url</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">setAttribute</span><span class="s7">(</span><span class="s8">"download"</span><span class="s7">,</span><span class="s1"> filename</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">visibility </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'hidden'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">link</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">click</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">removeChild</span><span class="s7">(</span><span class="s1">link</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s13">URL</span><span class="s7">.</span><span class="s1">revokeObjectURL</span><span class="s7">(</span><span class="s1">url</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s10"></span><br></p>
</body>
</html>
